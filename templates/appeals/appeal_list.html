{% extends "base.html" %}

{% block title %}{{ page_title }} - {{ SITE_NAME }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- Page Header -->
    <header class="mb-8 flex justify-between items-center">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">My Appeals</h1>
            <p class="text-gray-600">Track your appeals progress</p>
        </div>
        <a href="{% url 'appeals:appeal_start' %}"
           class="bg-blue-700 hover:bg-blue-800 text-white font-semibold py-2 px-4 rounded transition">
            + Start New Appeal
        </a>
    </header>

    <!-- Urgent Deadlines Alert -->
    {% if urgent_appeals %}
    <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6" role="alert">
        <p class="font-bold text-red-800">Urgent: Deadline Approaching</p>
        <ul class="mt-2 text-red-700">
            {% for appeal in urgent_appeals %}
            <li>
                <a href="{% url 'appeals:appeal_detail' appeal.pk %}" class="hover:underline">
                    {{ appeal.get_appeal_type_display|default:"Appeal" }} -
                    {{ appeal.days_until_deadline }} days remaining
                </a>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <!-- Active Appeals -->
    <section class="mb-10">
        <h2 class="text-xl font-bold text-gray-900 mb-4">Active Appeals</h2>

        {% if active_appeals %}
        <div class="space-y-4">
            {% for appeal in active_appeals %}
            <article class="bg-white rounded-lg shadow border p-5 hover:shadow-md transition">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="font-bold text-lg text-gray-900">
                            {% if appeal.appeal_type %}
                                {{ appeal.get_appeal_type_display }}
                            {% else %}
                                Appeal (Choosing Path)
                            {% endif %}
                        </h3>
                        <p class="text-gray-600 text-sm">
                            Decision Date: {{ appeal.original_decision_date|date:"M d, Y"|default:"Not set" }}
                        </p>
                        <p class="text-gray-500 text-sm mt-1">
                            Conditions: {{ appeal.conditions_appealed|truncatewords:15 }}
                        </p>
                    </div>

                    <div class="text-right">
                        {% include 'components/status_badge.html' with status=appeal.status display=appeal.get_status_display %}

                        {% if appeal.days_until_deadline %}
                        <p class="text-sm mt-2
                            {% if appeal.is_deadline_urgent %}text-red-600 font-bold
                            {% else %}text-gray-500{% endif %}">
                            {% if appeal.is_past_deadline %}
                                Deadline passed
                            {% else %}
                                {{ appeal.days_until_deadline }} days until deadline
                            {% endif %}
                        </p>
                        {% endif %}
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="mt-4">
                    <div class="flex justify-between text-sm text-gray-500 mb-1">
                        <span>Progress</span>
                        <span>{{ appeal.completion_percentage }}%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-blue-600 h-2 rounded-full" style="width: {{ appeal.completion_percentage }}%"></div>
                    </div>
                </div>

                <div class="mt-4">
                    <a href="{% url 'appeals:appeal_detail' appeal.pk %}"
                       class="text-blue-700 hover:text-blue-900 font-medium">
                        Continue &rarr;
                    </a>
                </div>
            </article>
            {% endfor %}
        </div>
        {% else %}
        <div class="bg-gray-50 rounded-lg p-8 text-center">
            <svg class="w-12 h-12 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
            <p class="text-gray-600 mb-4">You haven't started any appeals yet.</p>
            <a href="{% url 'appeals:decision_tree' %}"
               class="inline-flex items-center px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700">
                Find out which appeal is right for you
                <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
            </a>
        </div>
        {% endif %}
    </section>

    <!-- Completed Appeals -->
    {% if completed_appeals %}
    <section>
        <h2 class="text-xl font-bold text-gray-900 mb-4">Completed Appeals</h2>

        <div class="space-y-4">
            {% for appeal in completed_appeals %}
            <article class="bg-gray-50 rounded-lg border p-5">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="font-bold text-gray-900">
                            {{ appeal.get_appeal_type_display }}
                        </h3>
                        <p class="text-gray-600 text-sm">
                            Decided: {{ appeal.decision_received_date|date:"M d, Y"|default:"N/A" }}
                        </p>
                    </div>

                    <span class="inline-block px-3 py-1 text-sm rounded-full
                        {% if appeal.decision_outcome == 'granted' %}bg-green-100 text-green-800
                        {% elif appeal.decision_outcome == 'partial' %}bg-yellow-100 text-yellow-800
                        {% elif appeal.decision_outcome == 'denied' %}bg-red-100 text-red-800
                        {% elif appeal.decision_outcome == 'remanded' %}bg-blue-100 text-blue-800
                        {% else %}bg-gray-100 text-gray-800{% endif %}">
                        {{ appeal.get_decision_outcome_display }}
                    </span>
                </div>

                <div class="mt-3">
                    <a href="{% url 'appeals:appeal_detail' appeal.pk %}"
                       class="text-gray-600 hover:text-gray-900 text-sm">
                        View Details &rarr;
                    </a>
                </div>
            </article>
            {% endfor %}
        </div>
    </section>
    {% endif %}
</div>
{% endblock %}

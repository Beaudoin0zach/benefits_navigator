<div id="document-tags-section" class="bg-white rounded-lg shadow p-6">
    <h3 class="text-lg font-medium text-gray-900 mb-4">Condition Tags</h3>
    <p class="text-sm text-gray-500 mb-4">Link this document to specific conditions you're claiming.</p>

    {% if tags_updated %}
    <div class="mb-4 p-3 bg-green-50 text-green-800 text-sm rounded-lg" role="alert">
        Tags updated successfully.
    </div>
    {% endif %}

    <!-- Current Tags -->
    <div class="mb-4">
        {% if document.condition_tags %}
        <div class="flex flex-wrap gap-2">
            {% for tag in document.condition_tags %}
            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                {{ tag }}
            </span>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-sm text-gray-500 italic">No conditions tagged yet.</p>
        {% endif %}
    </div>

    <!-- Tag Edit Form -->
    <form method="post" action="{% url 'claims:document_update_tags' pk=document.pk %}"
          hx-post="{% url 'claims:document_update_tags' pk=document.pk %}"
          hx-target="#document-tags-section"
          hx-swap="outerHTML"
          class="mt-4">
        {% csrf_token %}
        <div class="flex items-start gap-2">
            <div class="flex-1">
                <input type="text" name="condition_tags"
                       value="{{ document.condition_tags|join:', ' }}"
                       placeholder="e.g., PTSD, Back Pain, Sleep Apnea"
                       class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm"
                       aria-label="Condition tags (comma-separated)">
                <p class="text-xs text-gray-500 mt-1">Separate multiple conditions with commas</p>
            </div>
            <button type="submit"
                    class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm font-medium">
                Update
            </button>
        </div>
    </form>

    <!-- Common Conditions Quick Add -->
    <div class="mt-4">
        <p class="text-xs text-gray-500 mb-2">Quick add common conditions:</p>
        <div class="flex flex-wrap gap-1">
            <button type="button" onclick="addTag('PTSD')" class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 rounded">+ PTSD</button>
            <button type="button" onclick="addTag('Tinnitus')" class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 rounded">+ Tinnitus</button>
            <button type="button" onclick="addTag('Hearing Loss')" class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 rounded">+ Hearing Loss</button>
            <button type="button" onclick="addTag('Back Pain')" class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 rounded">+ Back Pain</button>
            <button type="button" onclick="addTag('Sleep Apnea')" class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 rounded">+ Sleep Apnea</button>
            <button type="button" onclick="addTag('Migraines')" class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 rounded">+ Migraines</button>
            <button type="button" onclick="addTag('Knee Pain')" class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 rounded">+ Knee Pain</button>
            <button type="button" onclick="addTag('Anxiety')" class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 rounded">+ Anxiety</button>
            <button type="button" onclick="addTag('Depression')" class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 rounded">+ Depression</button>
            <button type="button" onclick="addTag('TBI')" class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 rounded">+ TBI</button>
        </div>
    </div>
</div>

<script>
function addTag(tag) {
    const input = document.querySelector('input[name="condition_tags"]');
    const current = input.value.trim();
    const tags = current ? current.split(',').map(t => t.trim()).filter(t => t) : [];
    if (!tags.includes(tag)) {
        tags.push(tag);
        input.value = tags.join(', ');
    }
}
</script>

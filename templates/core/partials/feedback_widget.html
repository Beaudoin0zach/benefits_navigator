{% comment %}
Feedback Widget - Include on pages to collect user feedback
Usage: {% include 'core/partials/feedback_widget.html' with page_title="Page Name" %}
{% endcomment %}

<div id="feedback-widget" class="fixed bottom-4 right-4 z-50">
    <!-- Collapsed State - Floating Button -->
    <button id="feedback-collapsed" type="button" class="bg-white rounded-full shadow-lg border border-gray-200 p-2 cursor-pointer hover:shadow-xl transition-shadow"
            aria-label="Open feedback form"
            onclick="document.getElementById('feedback-collapsed').classList.add('hidden'); document.getElementById('feedback-expanded').classList.remove('hidden');">
        <div class="flex items-center gap-2 px-3 py-1">
            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
            </svg>
            <span class="text-sm font-medium text-gray-700">Feedback</span>
        </div>
    </button>

    <!-- Expanded State - Quick Rating -->
    <div id="feedback-expanded" class="hidden bg-white rounded-lg shadow-xl border border-gray-200 p-4 w-72">
        <div class="flex justify-between items-start mb-3">
            <h4 class="text-sm font-semibold text-gray-900">Was this page helpful?</h4>
            <button onclick="document.getElementById('feedback-expanded').classList.add('hidden'); document.getElementById('feedback-collapsed').classList.remove('hidden');"
                    aria-label="Close feedback widget"
                    class="text-gray-400 hover:text-gray-600">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>

        <div id="feedback-buttons" class="flex justify-center gap-4 mb-3">
            <!-- Thumbs Up -->
            <button hx-post="{% url 'core:submit_feedback' %}"
                    hx-vals='{"rating": "positive", "page_url": "{{ request.path }}", "page_title": "{{ page_title|default:'' }}"}'
                    hx-target="#feedback-expanded"
                    hx-swap="innerHTML"
                    aria-label="Yes, this page was helpful"
                    class="flex flex-col items-center p-3 rounded-lg hover:bg-green-50 border-2 border-transparent hover:border-green-200 transition-all group">
                <span class="text-3xl group-hover:scale-110 transition-transform" aria-hidden="true">ğŸ‘</span>
                <span class="text-xs text-gray-600 mt-1">Yes</span>
            </button>

            <!-- Thumbs Down (opens form for more detail) -->
            <button hx-get="{% url 'core:feedback_form' %}"
                    hx-vals='{"rating": "negative", "page_url": "{{ request.path }}", "page_title": "{{ page_title|default:'' }}"}'
                    hx-target="#feedback-expanded"
                    hx-swap="innerHTML"
                    aria-label="No, this page was not helpful"
                    class="flex flex-col items-center p-3 rounded-lg hover:bg-red-50 border-2 border-transparent hover:border-red-200 transition-all group">
                <span class="text-3xl group-hover:scale-110 transition-transform" aria-hidden="true">ğŸ‘</span>
                <span class="text-xs text-gray-600 mt-1">No</span>
            </button>
        </div>

        <div class="text-center">
            <button hx-get="{% url 'core:feedback_form' %}"
                    hx-vals='{"rating": "", "page_url": "{{ request.path }}", "page_title": "{{ page_title|default:'' }}"}'
                    hx-target="#feedback-expanded"
                    hx-swap="innerHTML"
                    class="text-xs text-blue-600 hover:text-blue-800 hover:underline">
                Add more details
            </button>
        </div>
    </div>
</div>
